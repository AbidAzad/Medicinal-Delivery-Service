<!DOCTYPE html>
<html>
  
<body>
    <h1>Show File-select Fields</h1>
  
    <h3>
        Show a file-select field which allows
        only one file to be chosen:
    </h3>
          
        <label for="myfile">Select a file:</label>
        <input type="file" id="myfile" accept="image/jpeg" />
        <br /><br />
        <button onclick = "saveFile()"> SUBMIT</button>

        <button > GET</button>
    
</body>

<script>
    var fileReader = new FileReader();

    async function handleEvent(event){
        if (event.type == "load"){
            var uid = "TEST";
            var rawFileData = event.target.result;
        

            if (localStorage.getItem("User Record") != null){
                var user_record = JSON.parse(localStorage.getItem("User Record"));
                if (user_record != null && user_record.uid != null){
                    uid = user_record.uid
                }
            }

            var data = {
                rawFileData: rawFileData,
                uid: uid
            }

            alert(rawFileData.length);

            let response = await fetch('/upload/documentation', {
                method: 'POST',
                body: JSON.stringify(data),
                headers: {
                    'Content-type': 'application/json; charset=UTF-8',
                },
            })     
        }
    }

    function addListeners(reader) {
        reader.addEventListener("loadstart", handleEvent);
        reader.addEventListener("load", handleEvent);
        reader.addEventListener("loadend", handleEvent);
        reader.addEventListener("progress", handleEvent);
        reader.addEventListener("error", handleEvent);
        reader.addEventListener("abort", handleEvent);
    }

    async function saveFile(){
        const fileList = document.getElementById("myfile").files;
        addListeners(fileReader);
        fileReader.readAsText(fileList[0]);
    }

</script>
  
</html>
