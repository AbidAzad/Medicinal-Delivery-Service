<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="with=device-width, initial-scale=1.0">
        <title>DrugHub!!</title>
        <link rel ="stylesheet" href="./knowledge-base.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@1,300&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="./font-awesome-4.7.0/css/font-awesome.min.css">
    </head>

    <body>
        <header id="top" class = "testing">
            <img src="img/top_logo.png" class="logo" alt="logo">
            <img src="img/bottom_logo.png" class="logo_name" alt="logo">
            <nav>
                <ul class="nav_links">
                    <li>
                        <div class = "dropdown">
                            <a href="#" class="header_link">Medicines</a>
                            <div class = "dropdown-content">
                                <a href="./knowledge-base.html" class="drop_link">Knowledge Base</a>
                            </div>
                        </div>
                    </li>
                    <li><a href="#" class="header_link">Delivery</a></li>

                    <li>
                        <div class = "dropdown">
                            <a href="#" class="header_link">Our Service</a>
                            <div class = "dropdown-content">
                                <a href="./FAQ.html" class="drop_link">FAQ</a>
                            </div>
                        </div>
                    </li>
                        
                    <li><a href="#" class="header_link">Contact</a></li>
                    <li>
                    <div class="dropdown">
                        <image class="profile" id ="dropbtn" src = "img/profile.jpg" ></image>
                        <div class="dropdown-content">
                            <a href="#" class="drop_link">Manage Account</a>
                            <a href="#" class="drop_link">Request Prescriptions</a>
                            <a href="#" class="drop_link">View Orders</a>
                            <a href="#" id = "Link6" onclick = 'logout()' class="drop_link">Log Out</a>
                          </div>
                        </div></li>
                </ul>
            </nav>
            <a href="#"><button class="cart">Cart</button></a>
        </header>
        <section  class="header">

            
            <div class ="text-box">
                <h1>Welcome to the Drug Database</h1>
                <p> Got Questions? We got answers.<br> </p>
                <input id = "search_field" type="text" placeholder="Search..."></a>
                <button  id = "search_box"  class="log-btn">Find Out.</button>
            </div>
        </section>


        <section id="info" class="DrugFo">
            <h1>Search Results</h1>
            <p> Here's what we found:</p>

            <div class="row">

                <div class = "tableContainer">
                    <table id="tableArticles" class = "table">                      
                        <thead>
                            <tr ><th> Articles</th></tr>
                        </thead>
                        
                        <tbody id = "body">
                        </tbody>
                    </table>
                    <div class="loader"></div>
                   

                </div>
                

                
            </div>
                
            <div id="popup1" class="overlay">
                <div class="popup">
                    <h2 id="articleTitle">Lorem ipsum dolor sit amet consectetur adipisicing elit. Repellat nihil rerum omnis nulla non odit esse quasi eius maiores fuga ducimus quod, optio repudiandae porro recusandae laudantium animi adipisci rem!</h2>
                    <div id="articleContent" class="content">
                        Lorem ipsum dolor sit amet consectetur, adipisicing elit. Culpa ad exercitationem nobis voluptates corporis quae amet incidunt sunt. Aliquam, vel. Quae tempore explicabo qui ea ut officia veniam aspernatur adipisci?
                    </div>
                    <a  id = "goTo"  onclick='redirect()'  class="close" >Check it Out</a>
                    <a   class="close" onclick='exit()'>Exit</a>
                </div>

                
            </div>
  
                  
                  
        </section>




        <section class="another thing">
            <h1> </h1>
        </section>

       

    <script>
        var array = [];
        var selectedResult;
        document.getElementById("search_box").addEventListener("click",  function (){    
            
            document.getElementById("info").scrollIntoView();
            
            var tableHeaderRowCount = 1;
            var table = document.getElementById('tableArticles');
            var rowCount = table.rows.length;
            for (var i = tableHeaderRowCount; i < rowCount; i++) {
                table.deleteRow(tableHeaderRowCount);
            }

            document.body.classList.add("stop-scrolling");
            document.querySelector('.table').style.opacity = 0.50;
            document.querySelector('.loader').style.opacity = 1;
            document.querySelector('.tableContainer').style.pointerEvents = "none";
           
            var query = document.getElementById("search_field").value
            var data = {
                query: query
            };

            fetch("/knowledgebase/search", {
                method: 'POST',
                cache: 'no-cache',
                headers:{
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then((response ) => {
                if (response.status == 200){
                    array = [];
                    response.json().then(json => {
                        var organic_results = json["organic_results"];
                        for (let i = 0; i < Object.keys(organic_results).length || i < 50; i ++){
                            var result = organic_results[i];
                            let index = i + 1;
                            array.push(result);
                            //document.getElementById("tableArticles").innerHTML = result["displayed_link"];

                            //document.getElementById(`displayed_link_${index}`).href = result["link"];
                            //document.getElementById(`title_${index}`).innerHTML = result["title"];
                            //document.getElementById(`snippet_${index}`).innerHTML = result["snippet"];
                            //document.getElementById()

                            

                            //$('#tableArticle').append('<tr> <td> <a style="display: block;" href="#popup1">'+'THE TEST HAS WORKED!'+' </a> </td></tr>');
                            var rows= '<tr onclick="rowListen(this)"> <td><a style="display: block;" href="#popup1">'+result["title"]+'</a></td></tr>';
                            var table = document.getElementById('tableArticles');
                            var template = document.createElement('template');
                            template.innerHTML = rows;
                            table.appendChild(template.content);

                        }
                    })
                }

            })
            setTimeout( () => {
            document.querySelector('.table').style.opacity = 1;
            document.querySelector('.loader').style.opacity = 0;
            document.body.classList.remove("stop-scrolling")
            document.querySelector('.tableContainer').style.pointerEvents = "auto";  
            document.getElementById("info").scrollIntoView()},5000);
            
        
        });
        

        var navLinks = document.getElementById("navLinks");
        function showMenu(){
            navLinks.style.right="0";
        }

        function hideMenu(){
            navLinks.style.right="-200px";
        }
        function rowListen(x){
            var result = array[x.rowIndex-1];
            document.getElementById("articleTitle").innerText = result["title"];
            document.getElementById("goTo").href = result["link"];
            document.getElementById("articleContent").innerText = result["snippet"];
            selectedResult = result;
            document.querySelector('.overlay').style.opacity = 1;
            document.querySelector('.overlay').style.visibility = "visible";
            
        }
        function exit(){
            document.querySelector('.overlay').style.opacity = 0;
            document.querySelector('.overlay').style.visibility = "hidden";
        }

        function redirect(){
            document.querySelector('.overlay').style.opacity = 0;
            document.querySelector('.overlay').style.visibility = "hidden";
            location.replace(selectedResult["link"]);
        }
        
        
        
    </script>

</html>
